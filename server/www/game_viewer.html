<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="https://w2ui.com/src/w2ui-1.5.min.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.0/jquery.min.js"></script>
<script type="text/javascript" src="https://w2ui.com/src/w2ui-1.5.min.js"></script>
</head>
<body>
<a id="replay-link" href="" target="_blank">Link to Replay</a>
<div id="turn-grid" style="width: 100%; height: 250px;"></div>
<div id="instruction-grid" style="width: 100%; height: 250px;"></div>
<div id="move-grid" style="width: 100%; height: 250px;"></div>
</body>
<script>

function WriteReplayLink(link_id, game_id) {
    var link = document.getElementById(link_id);
    var url = new URL('/?replay_game=true&game_id=' + game_id, window.location.origin);
    link.href = url;
}

$(function () {
    var path = window.location.pathname
    var game_id = parseInt(window.location.pathname.split("/").at(-1));
    WriteReplayLink("replay-link", game_id);
    $('#turn-grid').w2grid({
        name: 'turn-grid',
        header: 'Game Turns',
        columns: [
          { field: 'id', text: 'Turn ID (Uniq)', size: '30%' },
          { field: 'number', text: 'Turn No', size: '30%' },
          { field: 'time', text: 'Time', size: '40%' },
          { field: 'notes', text: 'Notes', size: '40%' },
          { field: 'end_method', text: 'End Cause', size: '40%' }
        ],
        url: "/data/turns/" + game_id,
        onClick: function(event) {
          w2ui['instruction-grid'].clear();
          w2ui['move-grid'].clear();
          var record = this.get(event.recid);
          w2ui['instruction-grid'].load('/data/instructions/' + record.id);
          w2ui['move-grid'].load('/data/moves/' + record.id);
        }
    });
    $('#instruction-grid').w2grid({
      name: 'instruction-grid',
      header: "Turn Instructions",
      columns: [
          { field: 'instruction_number', text: 'Instruction No', size: '30%' },
          { field: 'turn_issued', text: 'Turn Issued', size: '30%' },
          { field: 'time', text: 'Time', size: '40%' },
          { field: 'turn_completed', text: 'Turn Completed', size: '40%' },
          { field: 'text', text: 'Instruction Text', size: '40%' }
      ],
    });
    $('#move-grid').w2grid({
      name: 'move-grid',
      header: "Turn Instructions",
      columns: [
          { field: 'character_role', text: 'Role', size: '30%' },
          { field: 'action_code', text: 'Action Code', size: '30%' },
          { field: 'game_time', text: 'Time', size: '40%' },
          { field: 'position_before', text: 'Position Before', size: '40%' },
          { field: 'instruction', text: 'Instruction Text', size: '40%' }
      ]
    });
});
</script>
</html>